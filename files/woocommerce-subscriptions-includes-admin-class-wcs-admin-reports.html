<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1663659953">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1663659953">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
            </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptionsAdmin.html"><abbr title="\WooCommerceSubscriptionsAdmin">WooCommerceSubscriptionsAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptionsClasses.html"><abbr title="\WooCommerceSubscriptionsClasses">WooCommerceSubscriptionsClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptions.html"><abbr title="\WooCommerceSubscriptions">WooCommerceSubscriptions</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerceSubscriptions-WC.html"><abbr title="\WooCommerceSubscriptions\WC">WC</abbr></a></li>
                                    <li><a href="../packages/WooCommerceSubscriptions-RestApi.html"><abbr title="\WooCommerceSubscriptions\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerceSubscriptions-WCS.html"><abbr title="\WooCommerceSubscriptions\WCS">WCS</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-SubscriptionsAPI.html"><abbr title="\WooCommerce\SubscriptionsAPI">SubscriptionsAPI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-SubscriptionsIncludesEmails.html"><abbr title="\WooCommerce\SubscriptionsIncludesEmails">SubscriptionsIncludesEmails</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WC.html"><abbr title="\WC">WC</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WC-Subscriptions.html"><abbr title="\WC\Subscriptions">Subscriptions</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptionsAdminUpgrades.html"><abbr title="\WooCommerceSubscriptionsAdminUpgrades">WooCommerceSubscriptionsAdminUpgrades</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptionsFunctions.html"><abbr title="\WooCommerceSubscriptionsFunctions">WooCommerceSubscriptionsFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerceSubscriptionsAdminMetaBoxes.html"><abbr title="\WooCommerceSubscriptionsAdminMetaBoxes">WooCommerceSubscriptionsAdminMetaBoxes</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
            <li class="phpdocumentor-breadcrumb"><a href="../packages/WooCommerceSubscriptionsAdmin.html">WooCommerceSubscriptionsAdmin</a></li>
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-wcs-admin-reports.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Reports Admin
 *
 * @author   Prospress
 * @category Admin
 * @package  WooCommerce Subscriptions/Admin
 * @version  2.0
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
} // Exit if accessed directly

/**
 * WCS_Admin_Reports Class
 *
 * Handles the reports screen.
 */
class WCS_Admin_Reports {

	/**
	 * Constructor
	 */
	public function __construct() {
		// Add the reports layout to the WooCommerce -&gt; Reports admin section
		add_filter( &#039;woocommerce_admin_reports&#039;, __CLASS__ . &#039;::initialize_reports&#039;, 12, 1 );

		// Add any necessary scripts
		add_action( &#039;admin_enqueue_scripts&#039;, __CLASS__ . &#039;::reports_scripts&#039; );

		// Add any actions we need based on the screen
		add_action( &#039;current_screen&#039;, __CLASS__ . &#039;::conditional_reporting_includes&#039; );
	}

	/**
	 * Add the &#039;Subscriptions&#039; report type to the WooCommerce reports screen.
	 *
	 * @param array Array of Report types &amp; their labels, excluding the Subscription product type.
	 * @return array Array of Report types &amp; their labels, including the Subscription product type.
	 * @since 2.1
	 */
	public static function initialize_reports( $reports ) {

		$reports[&#039;subscriptions&#039;] = array(
			&#039;title&#039;   =&gt; __( &#039;Subscriptions&#039;, &#039;woocommerce-subscriptions&#039; ),
			&#039;reports&#039; =&gt; array(
				&#039;subscription_events_by_date&#039; =&gt; array(
					&#039;title&#039;       =&gt; __( &#039;Subscription Events by Date&#039;, &#039;woocommerce-subscriptions&#039; ),
					&#039;description&#039; =&gt; &#039;&#039;,
					&#039;hide_title&#039;  =&gt; true,
					&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
				),
				&#039;upcoming_recurring_revenue&#039;  =&gt; array(
					&#039;title&#039;       =&gt; __( &#039;Upcoming Recurring Revenue&#039;, &#039;woocommerce-subscriptions&#039; ),
					&#039;description&#039; =&gt; &#039;&#039;,
					&#039;hide_title&#039;  =&gt; true,
					&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
				),
				&#039;retention_rate&#039;              =&gt; array(
					&#039;title&#039;       =&gt; __( &#039;Retention Rate&#039;, &#039;woocommerce-subscriptions&#039; ),
					&#039;description&#039; =&gt; &#039;&#039;,
					&#039;hide_title&#039;  =&gt; true,
					&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
				),
				&#039;subscription_by_product&#039;     =&gt; array(
					&#039;title&#039;       =&gt; __( &#039;Subscriptions by Product&#039;, &#039;woocommerce-subscriptions&#039; ),
					&#039;description&#039; =&gt; &#039;&#039;,
					&#039;hide_title&#039;  =&gt; true,
					&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
				),
				&#039;subscription_by_customer&#039;    =&gt; array(
					&#039;title&#039;       =&gt; __( &#039;Subscriptions by Customer&#039;, &#039;woocommerce-subscriptions&#039; ),
					&#039;description&#039; =&gt; &#039;&#039;,
					&#039;hide_title&#039;  =&gt; true,
					&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
				),
			),
		);

		if ( WCS_Retry_Manager::is_retry_enabled() ) {
			$reports[&#039;subscriptions&#039;][&#039;reports&#039;][&#039;subscription_payment_retry&#039;] = array(
				&#039;title&#039;       =&gt; __( &#039;Failed Payment Retries&#039;, &#039;woocommerce-subscriptions&#039; ),
				&#039;description&#039; =&gt; &#039;&#039;,
				&#039;hide_title&#039;  =&gt; true,
				&#039;callback&#039;    =&gt; array( &#039;WCS_Admin_Reports&#039;, &#039;get_report&#039; ),
			);
		}

		return $reports;
	}

	/**
	 * Add any subscriptions report javascript to the admin pages.
	 *
	 * @since 1.5
	 */
	public static function reports_scripts() {
		$suffix         = defined( &#039;SCRIPT_DEBUG&#039; ) &amp;&amp; SCRIPT_DEBUG ? &#039;&#039; : &#039;.min&#039;;
		$screen         = get_current_screen();
		$wc_screen_id   = sanitize_title( __( &#039;WooCommerce&#039;, &#039;woocommerce-subscriptions&#039; ) );
		$version        = WC_Subscriptions_Plugin::instance()-&gt;get_plugin_version();

		// Reports Subscriptions Pages
		if ( in_array( $screen-&gt;id, apply_filters( &#039;woocommerce_reports_screen_ids&#039;, array( $wc_screen_id . &#039;_page_wc-reports&#039;, &#039;toplevel_page_wc-reports&#039;, &#039;dashboard&#039; ) ) ) &amp;&amp; isset( $_GET[&#039;tab&#039;] ) &amp;&amp; &#039;subscriptions&#039; == $_GET[&#039;tab&#039;] ) {

			wp_enqueue_script( &#039;wcs-reports&#039;, WC_Subscriptions_Plugin::instance()-&gt;get_plugin_directory_url( &#039;assets/js/admin/reports.js&#039; ), array( &#039;jquery&#039;, &#039;jquery-ui-datepicker&#039;, &#039;wc-reports&#039;, &#039;accounting&#039; ), $version );

			// Add currency localisation params for axis label
			wp_localize_script( &#039;wcs-reports&#039;, &#039;wcs_reports&#039;, array(
				&#039;currency_format_num_decimals&#039; =&gt; wc_get_price_decimals(),
				&#039;currency_format_symbol&#039;       =&gt; get_woocommerce_currency_symbol(),
				&#039;currency_format_decimal_sep&#039;  =&gt; esc_js( wc_get_price_decimal_separator() ),
				&#039;currency_format_thousand_sep&#039; =&gt; esc_js( wc_get_price_thousand_separator() ),
				&#039;currency_format&#039;              =&gt; esc_js( str_replace( array( &#039;%1$s&#039;, &#039;%2$s&#039; ), array( &#039;%s&#039;, &#039;%v&#039; ), get_woocommerce_price_format() ) ), // For accounting JS
			) );

			wp_enqueue_script( &#039;flot-order&#039;, WC_Subscriptions_Plugin::instance()-&gt;get_plugin_directory_url( &#039;assets/js/admin/jquery.flot.orderBars&#039; ) . $suffix . &#039;.js&#039;, array( &#039;jquery&#039;, &#039;flot&#039; ), $version );
			wp_enqueue_script( &#039;flot-axis-labels&#039;, WC_Subscriptions_Plugin::instance()-&gt;get_plugin_directory_url( &#039;assets/js/admin/jquery.flot.axislabels&#039; ) . $suffix . &#039;.js&#039;, array( &#039;jquery&#039;, &#039;flot&#039; ), $version );

			// Add tracks script if tracking is enabled.
			if ( &#039;yes&#039; === get_option( &#039;woocommerce_allow_tracking&#039;, &#039;no&#039; ) ) {
				wp_enqueue_script( &#039;wcs-tracks&#039;, WC_Subscriptions_Plugin::instance()-&gt;get_plugin_directory_url( &#039;assets/js/admin/tracks.js&#039; ), array( &#039;jquery&#039; ), $version, true );
			}
		}
	}

	/**
	 * Add any reporting files we may need conditionally
	 *
	 * @since 2.1
	 */
	public static function conditional_reporting_includes() {

		$screen = get_current_screen();

		switch ( $screen-&gt;id ) {
			case &#039;dashboard&#039;:
				new WCS_Report_Dashboard();
				break;
		}

	}

	/**
	 * Get a report from one of our classes.
	 *
	 * @param string $name report name to be fetched.
	 */
	public static function get_report( $name ) {
		$name  = sanitize_title( str_replace( &#039;_&#039;, &#039;-&#039;, $name ) );
		$class = &#039;WCS_Report_&#039; . str_replace( &#039;-&#039;, &#039;_&#039;, $name );

		if ( ! class_exists( $class ) ) {
			return;
		}

		$report = new $class();
		$report-&gt;output_report();

		if ( class_exists( &#039;WC_Tracks&#039; ) ) {

			$reports = array(
				&#039;subscription-events-by-date&#039; =&gt; &#039;subscriptions_report_events_by_date_view&#039;,
				&#039;upcoming-recurring-revenue&#039;  =&gt; &#039;subscriptions_report_upcoming_recurring_revenue_view&#039;,
				&#039;retention-rate&#039;              =&gt; &#039;subscriptions_report_retention_rate_view&#039;,
				&#039;subscription-by-product&#039;     =&gt; &#039;subscriptions_report_by_product_view&#039;,
				&#039;subscription-by-customer&#039;    =&gt; &#039;subscriptions_report_by_customer_view&#039;,
				&#039;subscription-payment-retry&#039;  =&gt; &#039;subscriptions_report_payment_retry_view&#039;,
			);

			$properties = array(
				&#039;orders_count&#039;          =&gt; array_sum( (array) wp_count_posts( &#039;shop_order&#039; ) ),
				&#039;subscriptions_count&#039;   =&gt; array_sum( (array) wp_count_posts( &#039;shop_subscription&#039; ) ),
				&#039;subscriptions_version&#039; =&gt; WC_Subscriptions_Plugin::instance()-&gt;get_plugin_version(),
			);

			if ( in_array( $name, array( &#039;subscription-events-by-date&#039;, &#039;upcoming-recurring-revenue&#039;, &#039;subscription-payment-retry&#039; ), true ) ) {
				$properties[&#039;range&#039;] = ! empty( $_GET[&#039;range&#039;] ) ? sanitize_text_field( $_GET[&#039;range&#039;] ) : &#039;7day&#039;; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash,WordPress.Security.NonceVerification.Recommended
				if ( &#039;custom&#039; === $properties[&#039;range&#039;] ) {
					// We have to get start date from _GET variables since $report sets this far into the past when empty.
					$properties[&#039;start_date&#039;] = ! empty( $_GET[&#039;start_date&#039;] ) ? sanitize_text_field( $_GET[&#039;start_date&#039;] ) : null; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash,WordPress.Security.NonceVerification.Recommended
					$properties[&#039;end_date&#039;]   = gmdate( &#039;Y-m-d&#039;, $report-&gt;end_date );
					$properties[&#039;span&#039;]       = $properties[&#039;start_date&#039;] ? floor( ( $report-&gt;end_date - $report-&gt;start_date ) / DAY_IN_SECONDS ) + 1 . &#039;day&#039; : null;
				}
			}

			WC_Tracks::record_event( $reports[ $name ], $properties );
		}
	}

	/**
	 * If we hit one of our reports in the WC get_report function, change the path to our dir.
	 *
	 * @param string $report_path the parth to the report.
	 * @param string $name the name of the report.
	 * @param string $class the class of the report.
	 *
	 * @return string  path to the report template.
	 * @since 2.1
	 * @deprecated in favor of autoloading
	 * @access private
	 */
	public static function initialize_reports_path( $report_path, $name, $class ) {
		_deprecated_function( __METHOD__, &#039;2.4.0&#039; );
		if ( in_array( strtolower( $class ), array(
			&#039;wc_report_subscription_events_by_date&#039;,
			&#039;wc_report_upcoming_recurring_revenue&#039;,
			&#039;wc_report_retention_rate&#039;,
			&#039;wc_report_subscription_by_product&#039;,
			&#039;wc_report_subscription_by_customer&#039;,
			&#039;wc_report_subscription_payment_retry&#039;,
		) ) ) {
			$report_path = dirname( __FILE__ ) . &#039;/reports/classwcsreport&#039; . $name . &#039;.php&#039;;
		}

		return $report_path;
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on September 20th, 2022 at 07:45 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1663659953"></script>
    <script src="../js/search.js?updated=1663659953"></script>
</body>
</html>
